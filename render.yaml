# ===================================================
# ملف النشر النهائي لمنصة "مركز الإعلام" على Render
# ===================================================

databases:
  - name: markaz-media-db # يمكنك تغيير هذا الاسم إذا كان محجوزًا
    databaseName: media_platform_db
    user: db_user

services:
  # 1. الخادم الخلفي (Backend)
  - type: web
    name: backend
    plan: starter
    env: docker
    dockerfilePath: ./backend/Dockerfile
    dockerContext: ./backend
    healthCheckPath: /health # استخدام مسار فحص السلامة البسيط
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: markaz-media-db
          property: connectionString # <-- الخاصية الصحيحة لقاعدة البيانات
      - key: GEMINI_API_KEY
        sync: false # ستقوم بإضافة هذا يدويًا في لوحة التحكم
      - key: RENDER_FRONTEND_URL
        fromService:
          type: web
          name: frontend
          property: host # <-- الخاصية الصحيحة للخدمات

  # 2. الواجهة الأمامية (الرئيسية)
  - type: web
    name: frontend
    plan: starter
    env: docker
    dockerfilePath: ./frontend/Dockerfile
    dockerContext: ./frontend
    envVars:
      - key: NEXT_PUBLIC_API_URL # يمرر رابط الخادم الخلفي للواجهة
        fromService:
          type: web
          name: backend
          property: host # <-- الخاصية الصحيحة للخدمات

  # 3. خدمة مزامنة الفيديو
  - type: web
    name: video-sync-service
    plan: starter
    env: docker
    dockerfilePath: ./services/video-synchronizer/Dockerfile
    dockerContext: ./services/video-synchronizer
    envVars:
      - key: GEMINI_API_KEY
        sync: false

  # 4. خدمة صياغة الأخبار
  - type: web
    name: news-refine-service
    plan: starter
    env: docker
    dockerfilePath: ./services/news-refine/Dockerfile
    dockerContext: ./services/news-refine
    envVars:
      - key: GEMINI_API_KEY
        sync: false
  
  # 5. خدمة مولد الأفاتار
  - type: web
    name: avatar-service
    plan: starter
    env: docker
    dockerfilePath: ./services/dynamic-avatar/Dockerfile
    dockerContext: ./services/dynamic-avatar
    envVars:
      - key: GEMINI_API_KEY
        sync: false

  # 6. خدمة بوت الأخبار
  - type: web
    name: chatbot-service
    plan: starter
    env: docker
    dockerfilePath: ./services/news-chatbot/Dockerfile
    dockerContext: ./services/news-chatbot
    envVars:
      - key: GEMINI_API_KEY
        sync: false

  # 7. خدمة أتمتة أخبار الشرق
  - type: web
    name: asharq-service
    plan: starter
    env: docker
    dockerfilePath: ./services/asharq-news/Dockerfile
    dockerContext: ./services/asharq-news
    envVars:
      - key: GEMINI_API_KEY
        sync: false

  # 8. خدمة مساعد البودكاست
  - type: web
    name: podcast-service
    plan: starter
    env: docker
    dockerfilePath: ./services/podcast-helper/Dockerfile
    dockerContext: ./services/podcast-helper
    envVars:
      - key: GEMINI_API_KEY
        sync: false
        
  # 9. خدمة محرر الأسلوب
  - type: web
    name: style-editor-service
    plan: starter
    env: docker
    dockerfilePath: ./services/style-editor/Dockerfile
    dockerContext: ./services/style-editor
    envVars:
      - key: GEMINI_API_KEY
        sync: false
      - key: MAIN_BACKEND_URL
        fromService:
          type: web
          name: backend
          property: host # <-- الخاصية الصحيحة للخدمات

  # 10. خدمة محول الانفوجرافيك
  - type: web
    name: infographic-service
    plan: starter
    env: docker
    dockerfilePath: ./services/infographic-converter/Dockerfile
    dockerContext: ./services/infographic-converter
    envVars:
      - key: GEMINI_API_KEY
        sync: false